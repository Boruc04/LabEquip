{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"subscriptionId": {
			"type": "string"
		},
		"name": {
			"type": "string"
		},
		"location": {
			"type": "string"
		},
		"hostingEnvironment": {
			"type": "string"
		},
		"hostingPlanName": {
			"type": "string"
		},
		"serverFarmResourceGroup": {
			"type": "string"
		},
		"alwaysOn": {
			"type": "bool"
		},
		"sku": {
			"type": "string"
		},
		"skuCode": {
			"type": "string"
		},
		"workerSize": {
			"type": "string"
		},
		"workerSizeId": {
			"type": "string"
		},
		"numberOfWorkers": {
			"type": "string"
		},
		"currentStack": {
			"type": "string"
		}
	},
	"resources": [
		{
			"apiVersion": "2018-02-01",
			"name": "[parameters('name')]",
			"type": "Microsoft.Web/sites",
			"location": "[parameters('location')]",
			"tags": {},
			"dependsOn": [
				"microsoft.insights/components/LabEquipAppInsihts",
				"[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"
			],
			"properties": {
				"name": "[parameters('name')]",
				"siteConfig": {
					"appSettings": [
						{
							"name": "APPINSIGHTS_INSTRUMENTATIONKEY",
							"value": "[reference('microsoft.insights/components/LabEquipAppInsihts', '2015-05-01').InstrumentationKey]"
						},
						{
							"name": "ApplicationInsightsAgent_EXTENSION_VERSION",
							"value": "~2"
						},
						{
							"name": "XDT_MicrosoftApplicationInsights_Mode",
							"value": "default"
						},
						{
							"name": "DiagnosticServices_EXTENSION_VERSION",
							"value": "disabled"
						},
						{
							"name": "APPINSIGHTS_PROFILERFEATURE_VERSION",
							"value": "disabled"
						},
						{
							"name": "APPINSIGHTS_SNAPSHOTFEATURE_VERSION",
							"value": "disabled"
						},
						{
							"name": "InstrumentationEngine_EXTENSION_VERSION",
							"value": "disabled"
						},
						{
							"name": "SnapshotDebugger_EXTENSION_VERSION",
							"value": "disabled"
						},
						{
							"name": "XDT_MicrosoftApplicationInsights_BaseExtensions",
							"value": "disabled"
						}
					],
					"metadata": [
						{
							"name": "CURRENT_STACK",
							"value": "[parameters('currentStack')]"
						}
					],
					"alwaysOn": "[parameters('alwaysOn')]"
				},
				"serverFarmId": "[concat('/subscriptions/', parameters('subscriptionId'),'/resourcegroups/', parameters('serverFarmResourceGroup'), '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]",
				"hostingEnvironment": "[parameters('hostingEnvironment')]",
				"clientAffinityEnabled": true
			}
		},
		{
			"apiVersion": "2018-02-01",
			"name": "[parameters('hostingPlanName')]",
			"type": "Microsoft.Web/serverfarms",
			"location": "[parameters('location')]",
			"kind": "",
			"tags": {},
			"properties": {
				"name": "[parameters('hostingPlanName')]",
				"workerSize": "[parameters('workerSize')]",
				"workerSizeId": "[parameters('workerSizeId')]",
				"numberOfWorkers": "[parameters('numberOfWorkers')]",
				"hostingEnvironment": "[parameters('hostingEnvironment')]"
			},
			"sku": {
				"Tier": "[parameters('sku')]",
				"Name": "[parameters('skuCode')]"
			}
		},
		{
			"apiVersion": "2015-05-01",
			"name": "LabEquipAppInsihts",
			"type": "microsoft.insights/components",
			"location": "westeurope",
			"properties": {
				"ApplicationId": "[parameters('name')]",
				"Request_Source": "IbizaWebAppExtensionCreate"
			}
		}
	]
}